# Property Based Testing

This tool generates property-based tests for the file/dir/logs onramp for `tremor`

## Usage

This module is used during the testing phase to generate new test cases, therefore:

* while it is a subproject of `tremor` it is not a dependency
* the binary is not built during a normal build of `tremor`

When property-based tests need to be run, the makefile `cd`s into this directory and builds this command line binary, which is then invoked by the test runner to create a set of property based tests - which are then invoked.

## Basis of the tests

The file/dir/logs onramp listens on a directory (or directories) for changes:

* new files created
* lines written to files
* files deleted
* files moved or renamed

It then reads lines from those files, and processes them, passing them into tremor.

The tests generated by this module check the fact that this workflow has a trivial identify function: when you aggregate and then sort all the records you shove in the front - the list should be identical to the sorted output at the back.

The onramp guarantees to pass on every record written to files/logs/dirs as per the spec exactly once - but doesn't guaranteed to order in which it will do it.

If record `A` is written to file `X` before record `B` is written to file `Y` - both `A` and `B` will appear in the output - but not necessarily with the order `A`, `B` - it might be `B`, `A`

To that end this binary does two things.

Firstly it generates a set of tests which are coherent lists of actions:

```
create file X
write record A to X
write record B to X
rename X to Y
create file Z
write record C to Z
write record D to Y
delete file Z
delete file Y
```

These actions are coherent in the sense that:

* records are only written to files that exists
* only existing files are renamed, moved or deleted

The second thing it does is consume that list and actually run it.

These two things are done at different times:

* the first at build-test time
* the second at run time